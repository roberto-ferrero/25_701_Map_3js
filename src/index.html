<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map_3js</title>
    <!-- <link rel="stylesheet" href="style.css">  -->
</head>
<body>
    <div id="webgl_app"></div>
    <!-- <div id="content"> -->
    <div id="tooltip" style="
        position: fixed; 
        pointer-events: none; 
        display: none; 
        background: rgba(0, 0, 0, 0.8); 
        color: white; 
        padding: 8px 12px; 
        border-radius: 4px; 
        font-family: Arial, sans-serif; 
        font-size: 12px; 
        z-index: 1000;
    ">
    </div>

    </div>

    <!-- <script src="../dist/bundle.js"></script> -->

    <script>
        // Esperamos a que el DOM y los scripts estén listos
        window.addEventListener('load', () => {
            if (window.PandoraMap) {
                window.PandoraMap.init({
                    $container: document.querySelector('#webgl_app'),
                    $mouseEvents: document.querySelector('#webgl_app'),
                    debug: false,
                    loader_pathPrefix: "./", // Ruta relativa a sus assets si fuera necesario
                    cities_dataPath: "./data/cities.json",
                    shops_dataPath: "./data/shops.json",
                    events_dataPath: "./data/events.json",
                    settings: {
                        "drag_factors": [0.15, 0.05, 0.022, 0.0130, 0.0100],

                        "shop_scales": [0, 0, 0, 0.6, 0.4],

                        "city_scale_factor": 1,
                        "event_scale_factor": 1,
                        "shop_scale_factor": 1,

                        "city_opacity_factor": 1,
                        "event_opacity_factor": 1,
                        "shop_opacity_factor": 1,

                        "tier_1_in_zoom_0_scale_factor": 1,
                        "tier_2_in_zoom_0_scale_factor": 0,
                        "tier_3_in_zoom_0_scale_factor": 0,

                        "tier_1_in_zoom_1_scale_factor": 1,
                        "tier_2_in_zoom_1_scale_factor": 1,
                        "tier_3_in_zoom_1_scale_factor": 1,

                        "tier_1_in_zoom_2_scale_factor": 0.8,
                        "tier_2_in_zoom_2_scale_factor": 0.8,
                        "tier_3_in_zoom_2_scale_factor": 0.8,

                        "tier_1_in_zoom_3_scale_factor": 0.3,
                        "tier_2_in_zoom_3_scale_factor": 0.3,
                        "tier_3_in_zoom_3_scale_factor": 0.3,

                        "tier_1_in_zoom_4_scale_factor": 0.2,
                        "tier_2_in_zoom_4_scale_factor": 0.2,
                        "tier_3_in_zoom_4_scale_factor": 0.2
                    },
                    onInit: () => {
                        console.log("================================");
                        console.log("onInit!");
                        console.log("================================");
                    },
                    onZoomChange: (newZoomLevel) => {
                        console.log("================================");
                        console.log("ZOOM CHANGE: "+newZoomLevel);
                        console.log("================================");
                    },
                    onTierChange: (newTierLevel) => {
                        console.log("================================");
                        console.log("TIER CHANGE: "+newTierLevel);
                        console.log("================================");
                    },
                    onMarkerClicked: (type, id) => {
                        console.log("================================");
                        console.log("MARKER CLICKED: "+type+" - "+id);
                        console.log("================================");
                    }
                });

            // EVENTOS:
            window.platform.webglApp.emitter.on("onCityClicked", (data) => {
                console.log("CITY Clicked:", data.id);
                // Aquí puedes manejar el evento como desees
            })
            window.platform.webglApp.emitter.on("onEventClicked", (data) => {
                console.log("EVENT Clicked:", data.id);
                // Aquí puedes manejar el evento como desees
            })
            window.platform.webglApp.emitter.on("onShopClicked", (data) => {
                console.log("SHOP Clicked:", data.id);
                // Aquí puedes manejar el evento como desees
            })
            window.platform.webglApp.emitter.on("onAppZoomChange", (data) => {
                console.log("APP Zoom Changed:", data.zoom);
                // Se ha cambiado el zoom de la app
            })
            window.platform.webglApp.emitter.on("onAppTierModeChange", (data) => {
                console.log("APP Tier Mode Changed:", data.tier);
                // Se ha cambiado el modo tier
            })

            // API:
            // Metodos:
            // window.platform.webglApp.stage.get_MODE() // {"IDLE", "ZOOMING", "TRAVELLING", "SELECTING"} Intentar usar comandos del API con "IDLE" 
            // window.platform.webglApp.stage.get_ZOOM() // Obtiene el nivel de zoom actual
            // window.platform.webglApp.stage.get_TIER_LEVEL() // Obtiene el modo actual (modo tier)
            // window.platform.webglApp.stage.zoomIn() // Aumenta el zoom
            // window.platform.webglApp.stage.zoomOut() // Disminuye el zoom
            // window.platform.webglApp.stage.zoomToLevel(newZoomLevel) // Establece el zoom a un nivel específico
            // window.platform.webglApp.stage.selectMarker(markerId, typeId, newZoomLevel) // Mueve la camara a una ciudad/evento/tienda y establece el zoom y aplica el offset correspondiente
            // window.platform.webglApp.stage.resetOffset() // Deja de aplicar offset
            // window.platform.webglApp.stage.applyOffset() // Aplica offset


            } else {
                console.error("PandoraMap no se ha cargado correctamente.");
            }
        });
    </script> 

</body>
</html>






